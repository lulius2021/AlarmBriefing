"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},5855:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>_,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>m});var a=r(9303),i=r(8716),n=r(670),u=r(7070),l=r(2023),o=r.n(l),d=r(9487),f=r(9178);async function m(e){let{email:t,password:r,name:s}=await e.json();if(!t||!r)return u.NextResponse.json({error:"Email und Passwort erforderlich"},{status:400});if(r.length<8)return u.NextResponse.json({error:"Passwort muss mindestens 8 Zeichen lang sein"},{status:400});if(await d.DB.getUserByEmail(t.toLowerCase()))return u.NextResponse.json({error:"Email bereits registriert"},{status:409});let a=(0,d.Ox)(),i=await o().hash(r,12);await d.DB.createUser({id:a,email:t.toLowerCase(),name:s||"",password_hash:i,settings:{briefingModules:["weather","calendar","news"],voice:"jarvis",speed:1,location:"Berlin, DE"},created_at:new Date().toISOString()});let n=(0,f.fT)(a);return u.NextResponse.json({token:n,user:{id:a,email:t.toLowerCase(),name:s}})}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/data/.openclaw/workspace/AlarmBriefing/app/api/auth/register/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:_}=c,h="/api/auth/register/route";function w(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:g})}},9178:(e,t,r)=>{r.d(t,{AY:()=>l,Sp:()=>o,fT:()=>u});var s=r(1482),a=r.n(s),i=r(9487);let n=process.env.JWT_SECRET||"ab-dev-secret-change-in-prod";function u(e){return a().sign({userId:e},n,{expiresIn:"30d"})}function l(e){let t=e.headers.get("authorization");if(!t?.startsWith("Bearer "))return null;let r=function(e){try{return a().verify(e,n)}catch{return null}}(t.slice(7));return r?.userId||null}async function o(e){let t=e.headers.get("x-bot-key");if(!t)return null;let r=(0,i.Ym)(t),s=await i.DB.getBotByHash(r);return s?{userId:s.user_id,scopes:s.scopes}:null}},9487:(e,t,r)=>{r.d(t,{DB:()=>f,Ox:()=>u,Ym:()=>n,f1:()=>l});var s=r(4770),a=r.n(s),i=r(569);function n(e){return a().createHash("sha256").update(e).digest("hex")}function u(){return a().randomUUID()}function l(){return`ab_${a().randomBytes(32).toString("hex")}`}let o=globalThis;o.__mem||(o.__mem={users:new Map,alarms:new Map,botKeys:new Map,auditLog:[],briefings:new Map});let d=o.__mem,f={async createUser(e){if((0,i.jv)()){let{data:t,error:r}=await (0,i.tG)().from("app_users").insert(e).select().single();if(r)throw Error(r.message);return t}return d.users.set(e.id,e),e},async getUserByEmail(e){if((0,i.jv)()){let{data:t}=await (0,i.tG)().from("app_users").select("*").eq("email",e).single();return t}for(let[,t]of d.users)if(t.email===e)return t;return null},async getUserById(e){if((0,i.jv)()){let{data:t}=await (0,i.tG)().from("app_users").select("*").eq("id",e).single();return t}return d.users.get(e)||null},async deleteUser(e){if((0,i.jv)()){await (0,i.tG)().from("briefings").delete().eq("user_id",e),await (0,i.tG)().from("audit_log").delete().eq("user_id",e),await (0,i.tG)().from("app_bot_keys").delete().eq("user_id",e),await (0,i.tG)().from("alarms").delete().eq("user_id",e),await (0,i.tG)().from("app_users").delete().eq("id",e);return}for(let[t,r]of(d.users.delete(e),d.alarms.delete(e),d.briefings.delete(e),d.botKeys))r.user_id===e&&d.botKeys.delete(t);o.__mem.auditLog=d.auditLog.filter(t=>t.user_id!==e)},async getAlarms(e){if((0,i.jv)()){let{data:t}=await (0,i.tG)().from("alarms").select("*").eq("user_id",e).order("time");return t||[]}return d.alarms.get(e)||[]},async createAlarm(e){if((0,i.jv)()){let{data:t,error:r}=await (0,i.tG)().from("alarms").insert(e).select().single();if(r)throw Error(r.message);return t}let t=d.alarms.get(e.user_id)||[];return t.push(e),d.alarms.set(e.user_id,t),e},async updateAlarm(e,t,r){if((0,i.jv)()){let{data:s,error:a}=await (0,i.tG)().from("alarms").update({...r,updated_at:new Date().toISOString()}).eq("id",e).eq("user_id",t).select().single();return a?null:s}let s=d.alarms.get(t)||[],a=s.findIndex(t=>t.id===e);return -1===a?null:(s[a]={...s[a],...r,updated_at:new Date().toISOString()},s[a])},async deleteAlarm(e,t){if((0,i.jv)()){let{error:r}=await (0,i.tG)().from("alarms").delete().eq("id",e).eq("user_id",t);return!r}let r=d.alarms.get(t)||[];return d.alarms.set(t,r.filter(t=>t.id!==e)),!0},async countAlarms(e){if((0,i.jv)()){let{count:t}=await (0,i.tG)().from("alarms").select("*",{count:"exact",head:!0}).eq("user_id",e);return t||0}return(d.alarms.get(e)||[]).length},async createBotKey(e){if((0,i.jv)()){await (0,i.tG)().from("app_bot_keys").delete().eq("user_id",e.user_id),await (0,i.tG)().from("app_bot_keys").insert(e);return}for(let[t,r]of d.botKeys)r.user_id===e.user_id&&d.botKeys.delete(t);d.botKeys.set(e.hash,e)},async getBotByHash(e){if((0,i.jv)()){let{data:t}=await (0,i.tG)().from("app_bot_keys").select("*").eq("hash",e).single();return t}return d.botKeys.get(e)||null},async deleteBotKeys(e){if((0,i.jv)()){await (0,i.tG)().from("app_bot_keys").delete().eq("user_id",e);return}for(let[t,r]of d.botKeys)r.user_id===e&&d.botKeys.delete(t)},async addAudit(e){if((0,i.jv)()){await (0,i.tG)().from("audit_log").insert(e);return}d.auditLog.push(e)},async getAudit(e,t=50){if((0,i.jv)()){let{data:r}=await (0,i.tG)().from("audit_log").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(t);return r||[]}return d.auditLog.filter(t=>t.user_id===e).slice(-t)},async createBriefing(e){if((0,i.jv)()){let{data:t,error:r}=await (0,i.tG)().from("briefings").insert(e).select().single();if(r)throw Error(r.message);return t}let t=d.briefings.get(e.user_id)||[];return t.push(e),t.length>100&&t.shift(),d.briefings.set(e.user_id,t),e},async getLatestBriefing(e,t){if((0,i.jv)()){let{data:r}=await (0,i.tG)().from("briefings").select("*").eq("user_id",e).eq("alarm_id",t).order("created_at",{ascending:!1}).limit(1).single();return r}let r=(d.briefings.get(e)||[]).filter(e=>e.alarm_id===t);return r[r.length-1]||null}}},569:(e,t,r)=>{r.d(t,{jv:()=>n,tG:()=>l});var s=r(7857);let a=process.env.NEXT_PUBLIC_SUPABASE_URL||"";process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;let i=process.env.SUPABASE_SERVICE_ROLE_KEY||"",n=()=>!!a&&!!i,u=null,l=()=>n()?(u||(u=(0,s.eI)(a,i)),u):null}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,564,482,23],()=>r(5855));module.exports=s})();